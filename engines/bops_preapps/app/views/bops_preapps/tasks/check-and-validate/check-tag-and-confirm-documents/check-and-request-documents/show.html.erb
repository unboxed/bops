<%= render "shared/task_header", task: @task %>

<% documents = @planning_application.documents.active %>

<% additional_document_validation_requests = @planning_application.additional_document_validation_requests.pre_validation.open_or_pending %>

<%= render "planning_applications/validation/documents/check_and_request_documents",
      documents: documents,
      additional_document_validation_requests: additional_document_validation_requests,
      allow_cancel: @planning_application.invalidated?,
      redirect_to: task_path(@planning_application, @task),
      cancel_request_path_for: lambda { |validation_request|
        cancel_request_path(
          @planning_application,
          validation_request_id: validation_request.id,
          task_slug: @task.full_slug
        )
      } %>

<%= form_with model: @form, url: @form.url do |form| %>
  <%= form.hidden_field :documents_missing, value: additional_document_validation_requests.any? %>

  <%= render "shared/task_submit_buttons", form: form, save_draft: false %>
<% end %>
