<% content_for :page_title do %>
  <%= t(".edit_token") %> - <%= t("page_title") %>
<% end %>

<% add_parent_breadcrumb_link "Home", root_path %>
<% add_parent_breadcrumb_link "API tokens", tokens_path %>

<% content_for :title, t(".edit_token") %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-one-quarter">
    <%= render "side_navigation", current: "tokens" %>
  </div>
  <div class="govuk-grid-column-three-quarters">
    <h1>
      <%= t(".edit_token") %>
    </h1>

    <%= form_with model: @token, scope: :token, url: token_path(@token) do |form| %>
      <%= form.govuk_error_summary %>
      <%= form.govuk_fieldset(legend: {text: nil}) do %>
        <%= form.govuk_text_field :name, hint: {text: t(".hints.name")} %>
        <%= form.govuk_text_field :service, hint: {text: t(".hints.service")} %>
      <% end %>

      <%= form.govuk_radio_buttons_fieldset :authentication_type, legend: {text: t(".legends.authentication_type")}, hint: {text: t(".hints.authentication_type")} do %>
        <%= form.govuk_radio_button(:authentication_type, "bearer", label: {text: t(".labels.bearer_token")}) %>
        <%= form.govuk_radio_button(:authentication_type, "hmac", label: {text: t(".labels.hmac_digest")}) do %>
          <%= form.govuk_text_field :product_id, label: {text: t(".labels.product_id")} %>
          <%= form.govuk_text_field :client_id, label: {text: t(".labels.client_id")} %>
          <%= form.govuk_password_field :client_secret, label: {text: t(".labels.client_secret")}, value: @token.client_secret %>

          <p class="govuk-!-margin-top-5">
            Your submission endpoint for Planning Portal is:<br>
            <%= govuk_link_to nil, bops_submissions.v2_submissions_url(@token.sqid, schema: "planning-portal") %>
          </p>
        <% end %>
      <% end %>

      <%= form.govuk_check_boxes_fieldset(:permissions, multiple: false, legend: {text: t(".legends.permissions")}) do %>
        <% ApiUser::VALID_PERMISSIONS.each do |permission| %>
          <%= form.govuk_check_box :permissions, permission, checked: @token.permits?(permission), label: {text: tag.code(permission)} %>
        <% end %>
      <% end %>

      <%= render "file_downloader", form: form, file_downloader: @token.file_downloader %>

      <%= form.govuk_submit(t(".submit")) do %>
        <%= govuk_button_link_to t(".revoke"), token_path(@token), warning: true, method: :delete, data: {confirm: t(".confirm")} %>
        <%= govuk_button_link_to t("back"), tokens_path, secondary: true %>
      <% end %>
    <% end %>
  </div>
</div>
