<%= form_with(
  model: search,
  scope: '',
  builder: GOVUKDesignSystemFormBuilder::FormBuilder,
  method: :get,
  url: planning_applications_path(anchor: panel_type, status: selected_status),
  data: { controller: "clear-form" }
) do |form| %>
  <%= form.govuk_error_summary(presenter: ErrorPresenter) %>
  <div class="search-form-inputs">
    <%= form.govuk_fieldset(legend: { text: nil }) do %>
      <%= form.govuk_text_field(
        :query,
        class: "govuk-input--width-30",
        label: { text: t(".find_an_application") },
        hint: { text: t(".you_can_search") }
      ) %>
    <% end %>
    <% unless exclude_others? %>
      <%= hidden_field_tag(:view, "all") %>
    <% end %>
    <%= form.govuk_submit t(".search"), name: "submit", value: "search" %>
    <%= link_to(
      t(".clear_search"),
      clear_search_url,
      class: "govuk-button govuk-button--secondary",
      data: { action: "click->clear-form#handleClick" }
    ) %>
  </div>

  <% if panel_type == :all %>
    <div class="govuk-accordion single-section-accordion" data-module="govuk-accordion" data-controller="select-checkboxes">
      <div class="govuk-accordion__section">
        <div class="govuk-accordion__section-header">
          <h3 class="govuk-accordion__section-heading">
            <button type="button" class="govuk-accordion__section-button">
              <%= t(".status_filter", selected: selected_status_count, total: total_status_count) %>
            </button>
            <span class="govuk-accordion__icon"></span>
          </h3>
        </div>
        <div class="govuk-accordion__section-content">
          <%= form.govuk_collection_check_boxes(:status, all_statuses, :to_s, :humanize, small: true, legend: nil, classes: "display-flex") %>
          <%= form.govuk_submit "Apply filters", class: "govuk-button govuk-button--secondary" %>
        </div>
      </div>
    </div>
  <% end %>
<% end %>
