<% add_parent_breadcrumb_link "Home", planning_applications_path %>
<% add_parent_breadcrumb_link "Application", planning_application_path(@planning_application) %>
<% add_parent_breadcrumb_link "New change request", new_planning_application_change_request_path(@planning_application) %>

<% content_for :title, "Request replacement documents" %>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h2 class="govuk-heading-l govuk-!-padding-top-6">
      Request replacement documents
    </h2>
    <p class="govuk-body govuk-!-padding-bottom-3">
      The following documents have been marked as invalid.
    </p>
    <%= form_with model: [@planning_application, @document_change_request], local: true, builder: GOVUKDesignSystemFormBuilder::FormBuilder do |form| %>
      <% if @document_change_request.errors.any? %>
        <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="govuk-error-summary">
          <h2 class="govuk-error-summary__title" id="error-summary-title">
            There is a problem
          </h2>
          <div class="govuk-error-summary__body">
            <ul class="govuk-list govuk-error-summary__list">
              <% @document_change_request.errors.full_messages.each do |error| %>
                <li><%= error %></li>
              <% end %>
            </ul>
          </div>
        </div>
      <% end %>
      <table class="govuk-table">
        <thead class="govuk-table__head">
          <tr class="govuk-table__row">
            <th scope="col" class="govuk-table__header app-custom-class">Document</th>
            <th scope="col" class="govuk-table__header app-custom-class">File name</th>
            <th scope="col" class="govuk-table__header app-custom-class">Invalid reason</th>
          </tr>
        </thead>
        <tbody class="govuk-table__body">
          <% @planning_application.documents.invalidated.each do |document| %>
            <tr class="govuk-table__row">
              <td class="govuk-table__cell">
                <% if document.tags.present? %>
                  <% document.tags.each do |tag| %>
                    <%= tag.upcase %>
                  <% end %>
                <% end %>
              </td>
              <td class="govuk-table__cell"><%= document.name %></td>
              <td class="govuk-table__cell"><%= document.invalidated_document_reason %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <p class="govuk-body govuk-!-padding-top-6 govuk-!-padding-bottom-8">
        If you want to make any changes to the requests, return to <%= link_to "documents", planning_application_documents_path(@planning_application) %>
      </p>
      <%= form.govuk_submit "Send" %>
      <%= link_to "Back", new_planning_application_change_request_path(@planning_application), class: "govuk-button govuk-button--secondary" %>
    <% end %>
  </div>
</div>
