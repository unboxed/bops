<%= form_with model: [planning_application, decision], local: true, class: "decision" do |form| %>
<div class="govuk-form-group" data-controller="correction">
  <fieldset class="govuk-fieldset">
    <% if @planning_application.correction_provided? %>
      <h2 class="govuk-heading-m">Review the corrections</h2>
      <p class="govuk-body">
        <br>
        You sent the following comment about the officer's recommendation.
      </p>
      <div style="border: 1px solid; padding: 10px;">
        <p class="govuk-body"><%= @planning_application.reviewer_decision.correction %></p>
        <br>
      </div>
      <br>
      <p class="govuk-body">The planning officer has responded to your comment</p>
    <% else %>
      <h2 class="govuk-heading-m">Review the proposal</h2>
    <% end %>
    <p class="govuk-body">
      The planning officer recommends that the application is
      <strong><%= assessor_decision.status %></strong>
      <%= "and added this comment:" if assessor_decision.comment_made? %>
    </p>
    <% if assessor_decision.granted? && assessor_decision.comment_made? %>
      <div style="border: 1px solid; padding: 10px;">
        <p class="govuk-body"><%= assessor_decision.comment_met %></p>
      </div>
      <br>
    <% elsif assessor_decision.refused? && assessor_decision.comment_made? %>
      <div style="border: 1px solid; padding: 10px;">
        <p class="govuk-body"><%= assessor_decision.comment_unmet %></p>
      </div>
      <br>
    <% end %>
    <p class="govuk-body">Please review the applicant's answers:</p>
    <%= render "policy_consideration_list", policy_considerations: policy_evaluation.policy_considerations %>
    <div class="govuk-form-group <%= form.object.errors.any? ? 'govuk-form-group--error' : '' %> ">
      <p class="govuk-body">
        <strong>
          Do you agree with the recommendation?
        </strong>
      </p>
      <% if form.object.errors.any? %>
        <% form.object.errors.each do |attribute, error| %>
          <span id="status-error" class="govuk-error-message">
            <span class="govuk-visually-hidden">Error:</span><%= error %></span>
        <% end %>
      <% end %>

      <% reviewer_agrees_status = assessor_decision.status %>
      <% reviewer_disagrees_status = Decision.statuses.keys.find { |s| s != assessor_decision.status } %>

      <div class="govuk-radios govuk-radios--small govuk-radios--conditional" data-module="govuk-radios">
        <div class="govuk-radios__item">
          <%= form.radio_button :status, reviewer_agrees_status, class: "govuk-radios__input", "data-action":"click->correction#toggleCorrection", checked: false %>
          <%= form.label :"status_#{reviewer_agrees_status}", "Yes", class: "govuk-radios__label" %>
        </div>
        <div class="govuk-radios__item">
          <%= form.radio_button :status, reviewer_disagrees_status, class: "govuk-radios__input", checked: false, id: "reviewer-disagrees-conditional", "data-action":"click->correction#toggleCorrection", "aria-controls": "conditional-reviewer-disagrees-conditional", "aria-expanded": "false" %>
          <%= form.label :"status_#{reviewer_disagrees_status}", "No", class: "govuk-radios__label", for: "reviewer-disagrees-conditional" %>
        </div>
        </div>
      </div>
  </fieldset>
  <div class="add-correction"  data-target="correction.correctionDiv">
    <p class="govuk-body">
      <br />
      Please provide comments on why you don't agree.
    </p>
    <%= form.text_area :correction, id: "correction", class: "govuk-textarea", "data-target":"correction.textArea", rows: "3" %>
  </div>
  <p>
    <%= form.submit "Save", class: "govuk-button", data: { module: "govuk-button" } %>
  </p>
</div>
<% end%>
