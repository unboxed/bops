<%= render "validation_requests/validation_requests_breadcrumbs" %>
<% content_for :title, "Other validation request" %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-l govuk-!-padding-top-5">
      <% if @other_change_validation_request.closed? %>
        Check the response to other request <%= "(fee)" if @other_change_validation_request.fee_item? %>
      <% else %>
        View other request <%= "(fee)" if @other_change_validation_request.fee_item? %>
      <% end %>
    </h1>

    <h2 class="govuk-heading-m">Officer request</h2>

    <% if @other_change_validation_request.fee_item? %>
      <p class="govuk-body">
        <strong>Invalid fee previously paid </strong> <%= number_to_currency (@planning_application.invalid_payment_amount), unit: '£' %>
      </p>
    <% end %>

    <div class="govuk-inset-text">
      <p class="govuk-body">
        <strong> Reason it is invalid: </strong> <%= @other_change_validation_request.summary  %>
      </p>
      <p class="govuk-body">
        <strong> How it can be made valid: </strong> <%= @other_change_validation_request.suggestion %>
      </p>
      <p class="govuk-body">
      <%= @other_change_validation_request.created_at %>
      </p>
    </div>

      <% if @other_change_validation_request.closed? && @planning_application.invalidated?  %>
        <h2 class="govuk-heading-m">Applicant response</h2>
        <div class="govuk-inset-text">
          <p class="govuk-body">
            <%= @other_change_validation_request.response %>
          </p>
          <p class="govuk-body">
            <%= @other_change_validation_request.updated_at %>
          </p>
        </div>

        <%= form_with model: @planning_application, local: true, builder: GOVUKDesignSystemFormBuilder::FormBuilder do |form| %>
          <div class="govuk-form-group">
            <h2 class="govuk-heading-m">
              Total fee paid
            </h2>
            <p class="govuk-body">
              Check any extra fee has been received and update the total fee now paid.
            </p>
            <div class="govuk-input__wrapper">
              <div class="govuk-input__prefix" aria-hidden="true">£</div>
              <%= form.text_field :payment_amount, value: number_to_currency(@planning_application.payment_amount, unit: ""), class: "govuk-textarea govuk-input" %>
              <%= hidden_field_tag(:edit_action, "edit_payment_amount") %>
              <%= hidden_field_tag(:other_change_validation_request_id, @other_change_validation_request.id) %>
            </div>
          </div>

          <%= render "shared/validation_request_show_actions",
              planning_application: @planning_application, validation_request: @other_change_validation_request, form: form %>
        <% end %>
      <% else %>
        <% if @planning_application.invalidated? %>
          <h2 class="govuk-heading-m">Applicant has not responded yet</h2>
        <% end %>

        <%= render "shared/validation_request_show_actions",
            planning_application: @planning_application, validation_request: @other_change_validation_request, form: nil %>
      <% end %>
  </div>
</div>
