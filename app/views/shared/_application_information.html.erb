<div class="govuk-accordion" data-module="govuk-accordion" id="accordion-default">
  <div class="govuk-accordion__section">
    <div class="govuk-accordion__section-header">
      <h3 class="govuk-accordion__section-heading">
          <!-- We have removed aria controls due to a problem with the default npm gov-uk functionality, which forces accordions to stay open by using the aria controls classes to setState in the browser, and force them open.
      Our research suggests this makes the website harder to use as there is too much information on the screen overwhelming the user.
      For now we are removing these until we create our own version of the gov-uk library that stops the behaviour of forcing accordions open. -->
        <button type="button" id="accordion-default-heading-1" aria-controls="" class="govuk-accordion__section-button" aria-expanded="false">
          Application information
          <span class="govuk-accordion__icon" aria-hidden="true"></span></button>
      </h3>
    </div>
    <div class="govuk-accordion__section-content" aria-labelledby="accordion-default-heading-1">
      <p class="govuk-body">
        <%= link_to 'Edit details', edit_planning_application_path(@planning_application) %>
      </p>
      <hr>
      <table class="govuk-table">
        <tbody class="govuk-table__body">
          <tr class="govuk-table__row">
            <td class="govuk-table__cell"><strong>Address:</strong></td>
            <td class="govuk-table__cell"><%= @planning_application.full_address %></td>
          </tr>
          <tr class="govuk-table__row">
            <td class="govuk-table__cell"><strong>Location:</strong></td>
            <td class="govuk-table__cell"><%= link_to 'Map link', map_link(@planning_application.full_address), target: '_blank' %></td>
          </tr>
          <tr class="govuk-table__row">
            <td class="govuk-table__cell"><strong>UPRN:</strong></td>
            <td class="govuk-table__cell"><%= @planning_application.uprn %></td>
          </tr>
          <tr class="govuk-table__row">
            <td class="govuk-table__cell"><strong>Application type:</strong></td>
            <td class="govuk-table__cell">Proposed permitted development:
              <%= t("application_types.#{@planning_application.application_type}") %>
            </td>
          </tr>
          <tr class="govuk-table__row">
            <td class="govuk-table__cell"><strong>Work already completed:</strong></td>
            <td class="govuk-table__cell"><%= proposed_or_existing(@planning_application) %>
            </td>
          </tr>
          <tr class="govuk-table__row">
            <td class="govuk-table__cell"><strong>Description:</strong></td>
            <td class="govuk-table__cell">
              <p class="govuk-body">
                <%= @planning_application.description %>
              </p>
            </td>
          </tr>
          <tr class="govuk-table__row">
            <td class="govuk-table__cell"><strong>Payment Reference:</strong></td>
            <td class="govuk-table__cell">
              <p class="govuk-body">
                <%= @planning_application.payment_reference %>
              </p>
            </td>
          </tr>
          <tr class="govuk-table__row">
            <td class="govuk-table__cell noborder"><strong>Case officer:</strong></td>
            <td class="govuk-table__cell noborder">
              <p class="govuk-body"><%= @planning_application.user ? @planning_application.user.name : "Not assigned" %></p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="govuk-accordion__section">
    <div class="govuk-accordion__section-header">
      <h3 class="govuk-accordion__section-heading">
        <!-- We have removed aria controls due to a problem with the default npm gov-uk functionality, which forces accordions to stay open by using the aria controls classes to setState in the browser, and force them open.
        Our research suggests this makes the website harder to use as there is too much information on the screen overwhelming the user.
        For now we are removing these until we create our own version of the gov-uk library that stops the behaviour of forcing accordions open. -->
        <button type="button" id="accordion-default-heading-2" aria-controls="" class="govuk-accordion__section-button" aria-expanded="false">
          Site Map
        </button>
          <span class="govuk-accordion__icon" aria-hidden="true"></span>
      </h3>
    </div>
    <div class="govuk-accordion__section-content" aria-labelledby="accordion-default-heading-2">
      <% if @planning_application.boundary_geojson.present? %>
        <div id='map' style="width: 100%; height: 200px"></div>
        <script>
          var map = L.map('map', {minZoom: 8, maxZoom: 22});
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 22,
            maxNativeZoom: 19
          }).addTo(map);
          var boundary = L.geoJSON(<%= JSON.parse(@planning_application.boundary_geojson).to_json.html_safe %>, {"color": "#ff0000", "weight": 2, "opacity": 0.65}).addTo(map);
          map.fitBounds(boundary.getBounds());

          function accordion_expanded() {
            map.invalidateSize().fitBounds(boundary.getBounds());
          }
        </script>
      <% else %>
        <p class="govuk-body">No digital sitemap provided</p>
      <% end %>
    </div>
  </div>

    <%= render "planning_applications/policy_consideration_list" %>
    <%= render "shared/proposal_documents" %>
</div>
