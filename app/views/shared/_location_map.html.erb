<my-map
  style="width: 100%; height: 400px;"
  osVectorTilesApiKey='<%= ENV['OS_VECTOR_TILES_API_KEY'] %>'
  showScale
  useScaleBarStyle
  <% if locals[:geojson].present? %>
    geojsonData='<%= locals[:geojson].is_a?(Hash) ? locals[:geojson].to_json : JSON.parse(locals[:geojson]).to_json.html_safe %>'
    <% if locals[:invalid_red_line_boundary].present? %>
      geojsonColor='#515151'
    <% end %>
  <% elsif @planning_application.latitude && @planning_application.longitude %>
    zoom="19"
    latitude='<%= @planning_application.latitude %>'
    longitude='<%= @planning_application.longitude %>'
    showMarker
    markerLatitude="<%= @planning_application.latitude %>"
    markerLongitude="<%= @planning_application.longitude %>"
    markerImage="pin"
  <% end %>
  <% if locals[:geojson_field].present?  %>
    drawMode="true"
  <% end %>
></my-map>

<script>
  const map = document.querySelector("my-map");
  <% if locals[:geojson_field].present? %>
    map.addEventListener("geojsonChange", ({ detail: geoJSON }) => {
      document.querySelector("[id^='<%= locals[:geojson_field] %>']").value = JSON.stringify(geoJSON);
    });
  <% end %>
  <% if locals[:in_accordion] == true %>
    function accordion_expanded() {
      window.dispatchEvent(new Event("resize"));
    }
  <% end %>
</script>
