<% content_for :title, "Validate application" %>

<%= render "planning_applications/assessment_dashboard" do %>
  <h2 class="govuk-heading-l">
    Validate application
  </h2>

  <% if @planning_application.invalid_documents.present? %>
      <div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1">
        <svg class="alert__icon" fill="red" role="presentation" focusable="false" xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 25 25" height="25" width="25">
          <path d="M13.6,15.4h-2.3v-4.5h2.3V15.4z M13.6,19.8h-2.3v-2.2h2.3V19.8z M0,23.2h25L12.5,2L0,23.2z"></path>
        </svg>
        <div class="govuk-error-summary__body">
          <ul class="govuk-list govuk-error-summary__list">
            <li>
              Invalid documents:
              <strong>
                <%= @planning_application.invalid_documents.count %>
              </strong>
            </li>
          </ul>
        </div>
      </div>
    <% end %>

  <% if @planning_application.not_started? %>
    <p class="govuk-body">
      <strong>
        The application has not yet been marked as valid or invalid
      </strong>
    </p>

    <p class="govuk-body">
      <%= link_to "Check documents", planning_application_documents_path(@planning_application), class: "govuk-link" %>
    </p>
    <p class="govuk-body">
      Once the application has been checked, mark the application as valid.
    </p>
    <p class="govuk-body">
      <%= link_to "Mark the application as valid", confirm_validation_planning_application_path(@planning_application), class: "govuk-button" %>
    </p>
    <h3 class="govuk-heading-m">
      Mark the application as invalid
    </h3>
    <p class="govuk-body">
      If the application is invalid, you will need to request changes from the applicant before you can mark the application as invalid.
    </p>
    <%= link_to "Request validation changes", planning_application_validation_requests_path(@planning_application), class: "govuk-button" %>

  <% elsif @planning_application.invalidated? %>
    <p class="govuk-body">
      <strong>
        <%= "The application is marked as invalid. The applicant was notified on #{@planning_application.invalidated_at}" %>
      </strong>
    </p>
    <p class="govuk-body">
      <%= link_to "Check documents", planning_application_documents_path(@planning_application), class: "govuk-link" %>
    </p>
    <h2 class="govuk-heading-m">
      Validation requests
    </h2>
    <p class="govuk-body">
      <%= validation_request_summary(@planning_application.validation_requests, @planning_application) %>
    </p>
    <p class="govuk-body">
      <%= link_to "Start new or view existing requests", planning_application_validation_requests_path(@planning_application), class: "govuk-link" %>
    </p>
    <p class="govuk-body">
      Once the application has been checked and all validation requests resolved, mark the application as valid.
    </p>
    <p class="govuk-body">
      <%= link_to "Mark the application as valid", confirm_validation_planning_application_path(@planning_application), class: "govuk-button" %>
    </p>
  <% end %>

  <% if @planning_application.validated? %>
    <p class="govuk-body">
      <strong>
        The application is marked as valid<%= @planning_application.may_invalidate? ? "." : " and cannot be marked as invalid." %><br/>
        The applicant was notified on <%= @planning_application.documents_validated_at %>
      </strong>
    </p>
    <p class="govuk-body">
      <%= link_to "View notification", validation_notice_planning_application_path(@planning_application), class: "govuk-link" %>
    </p>
    <h2 class="govuk-heading-m">
      Validation requests
    </h2>
    <p class="govuk-body">
      <%= validation_request_summary(@planning_application.validation_requests, @planning_application) %>
    </p>
  <% end %>
<% end %>
