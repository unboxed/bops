<% accordion.with_section(id: "review-pre-commencement-conditions", expanded: current_review.errors.any?) do |section| %>
  <% section.with_heading(text: "Review pre-commencement conditions") %>

  <% section.with_status do %>
    <%= render(
          StatusTags::ReviewComponent.new(
            review_item: current_review,
            updated: current_review.updated?
          )
        ) %>
  <% end %>

  <% section.with_block do %>
    <% if conditions.any? %>
      <ol class="govuk-list">
        <% conditions.each do |condition| %>
          <%= content_tag :li, id: dom_id(condition, :pre_commencement) do %>
            <div class="govuk-!-margin-bottom-6">
              <span class="govuk-caption-m">Pre-commencement Condition <%= condition.position %></span>
              <h2 class="govuk-!-margin-bottom-1"><%= condition.title %></h2>

              <div data-controller="summary">
                <div class="bops-summary" data-summary-target="content">
                  <%= render(FormattedContentComponent.new(text: condition.text)) %>

                  <h3 class="govuk-!-margin-bottom-1">Reason</h3>
                  <%= render(FormattedContentComponent.new(text: condition.reason)) %>
                </div>

                <nav class="nav-links" data-summary-target="navigation" aria-label="Actions for pre-commencement condition <%= condition.position %>">
                  <%= govuk_link_to "Edit to accept", edit_planning_application_review_pre_commencement_conditions_item_path(@planning_application, condition) %>
                </nav>
              </div>
            </div>
          <% end %>
        <% end %>
      </ol>

      <p class="govuk-body-s govuk-!-margin-bottom-0">
        <%= govuk_link_to "Rearrange pre-commencement conditions", edit_planning_application_review_pre_commencement_conditions_path(@planning_application) %>
      </p>
    <% else %>
      <p>
        There are no pre-commencement conditions.
      </p>
    <% end %>
  <% end %>

  <% section.with_footer(id: "review-pre-commencement-conditions-form") do %>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <%= form_with model: current_review, scope: "review_pre_commencement_conditions",
              url: planning_application_review_pre_commencement_conditions_path(@planning_application, anchor: "review-pre-commencement-conditions-form") do |form| %>

          <%= form.govuk_radio_buttons_fieldset :action, small: true, legend: nil do %>
            <%= form.govuk_radio_button :action, :accepted, label: {text: "Agree"} %>
            <%= form.govuk_radio_button :action, :rejected, label: {text: "Return with comments"} do %>
              <%= form.govuk_text_area(:comment, rows: 3, label: {text: "Add a comment"}) %>
            <% end %>
          <% end %>

          <%= form.govuk_submit "Save and mark as complete", name: "review_pre_commencement_conditions[review_status]", value: "review_complete" %>
        <% end %>
      </div>
    </div>
  <% end %>
<% end %>
