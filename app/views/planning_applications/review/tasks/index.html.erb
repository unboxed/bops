<% content_for :page_title do %>
  Review and sign-off - <%= t('page_title') %>
<% end %>

<% add_parent_breadcrumb_link "Home", root_path %>
<% add_parent_breadcrumb_link "Application", planning_application_path(@planning_application) %>
<% content_for :title, t(".review_and_sign_off") %>

<%= render(
  partial: "shared/proposal_header",
  locals: { heading: t(".review_and_sign_off") }
) %>

<%= render "shared/dates_and_assignment_header" %>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h2 class="govuk-heading-m govuk-!-margin-bottom-0 govuk-!-margin-top-5">
      <%= t(".application_details") %>
    </h2>
    <%= render(
      AccordionComponent.new(planning_application: @planning_application)
    ) %>
    <h2 class="app-task-list__section govuk-!-margin-top-8">
      Review assessment
    </h2>
    <span class="govuk-body govuk-!-font-weight-bold">
      Assessor recommendation
      <%= render(
      StatusTags::DecisionComponent.new(
        planning_application: @planning_application
      )
    ) %>
    </span>
    <ul class="app-task-list__items" id="review-assessment-section">
      <% if @planning_application.possibly_immune? && @planning_application.immunity_detail.reviews.evidence.any? %>
          <%= render(
            TaskListItems::Reviewing::ImmunityDetailsComponent.new(
              planning_application: @planning_application
            )
          ) %>
      <% end %>
      <% if @planning_application.possibly_immune? && @planning_application.immunity_detail.reviews.enforcement.any? %>
          <%= render(
            TaskListItems::Reviewing::ImmunityEnforcementComponent.new(
              planning_application: @planning_application
            )
          ) %>
      <% end %>
      <% if @planning_application.review_permitted_development_rights? %>
        <%= render(
          TaskListItems::Reviewing::PermittedDevelopmentRightComponent.new(
            planning_application: @planning_application
          )
        ) %>
      <% end %>
      <%= render(
        TaskListItems::Reviewing::AssessmentDetailsComponent.new(
          planning_application: @planning_application,
        )
      )%>
      <% if @planning_application.local_policy.present? %>
        <%= render(
          TaskListItems::Reviewing::LocalPolicyComponent.new(
            planning_application: @planning_application,
          )
        )%>
      <% end %>
      <% if @planning_application.application_type.planning_conditions? %>
        <% if @planning_application.condition_set.present? && @planning_application.condition_set.current_review&.status != "not_started" %>
          <%= render(
            TaskListItems::Reviewing::ConditionComponent.new(
              condition_set: @planning_application.condition_set,
            )
          )%>
        <% end %>
      <% end %>

      <%= render partial: "policy_classes", locals: { planning_application: @planning_application, policy_class: @policy_class } %>

      <% if @planning_application.committee_decision&.recommend? %>
        <%= render(
          TaskListItems::Reviewing::CommitteeComponent.new(
            planning_application: @planning_application,
          )
        )%>
      <% end %>

      <%= render "sign_off_recommendation" %>
    </ul>
  </div>
</div>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <%= render(Reviewing::Tasks::AfterSignOffComponent.new(planning_application: @planning_application)) %>
  </div>
</div>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <%= render(Reviewing::Tasks::ButtonGroupComponent.new(planning_application: @planning_application)) %>
  </div>
</div>
