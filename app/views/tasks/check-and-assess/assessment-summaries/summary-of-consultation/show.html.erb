<%= render "task_header", task: @task %>
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <% if @planning_application.consultation && @planning_application.consultation.consultees.present? %>
      <h2><%= t(".responses") %></h2>
      <%= govuk_accordion(html_attributes: {id: "consultation-responses"}) do |accordion| %>
        <% @planning_application.consultation.consultees.each do |consultee| %>
          <% accordion.with_section(heading_text: consultee.name) do %>
            <% consultee.responses.each do |response| %>
            <div class="govuk-!-margin-bottom-2">
              <% case response.summary_tag %>
              <% when "approved" %>
                <%= tag.span(t("consultee_response.summary_tags.approved"), class: "govuk-tag govuk-tag--green") %>
              <% when "amendments_needed" %>
                <%= tag.span(t("consultee_response.summary_tags.amendments_needed"), class: "govuk-tag govuk-tag--yellow") %>
              <% when "objected" %>
                <%= tag.span(t("consultee_response.summary_tags.objected"), class: "govuk-tag govuk-tag--red") %>
              <% end %>
            </div>
              <p class="govuk-body"><%= response.response %></p>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    <% else %>
      <p class="govuk-body">
        No consultation responses have been received.
      </p>
    <% end %>
  </div>
</div>

<%= form_with model: @form, url: @form.url do |form| %>
  <%= form.govuk_error_summary %>
  <%= form.govuk_text_area(:entry, rows: 10, value: @form.assessment_detail.entry, label: {text: t(".heading"), tag: "h2", size: "m"}) do %>

    <% if @planning_application.publishable? %>
      <%= govuk_warning_text(text: t(".warning")) %>
    <% end %>
  <% end %>
  <%= render "task_submit_buttons", form: form %>

<% end %>
